/**
 * Created by mgl on 16.10.17.
 */
$(function () {
    console.log("Initiating navigation");
    var chart = new Highcharts.StockChart({
        chart: {
            renderTo: 'container',
            height: 120

        },

        xAxis: {
            min: 1507994411000,
            max: 1508253611000,
            lineWidth: 0,
            tickLength: 0,
            minRange : 1000 * 60, // one minute in milliseconds
            maxRange : 1000 * 60 * 60 * 24 * 31 * 12,// about 12 months in
            labels: {
                enabled: false
            },
            events: {

                afterSetExtremes: afterSetExtremes,
                setExtremes: function (e) {
                        runSyncFromTimeline({'start':e.min,'end':e.max,'byUser':true});
                        runSyncFromGraph({'start':e.min,'end':e.max,'byUser':true});
                }
            }
        },
        rangeSelector: {

            allButtonsEnabled: true,
            buttons: [{
                type: 'minute',
                count: 15,
                text: '15\'',
            },{
                type: 'hour',
                count: 1,
                text: '1h'
            },{
                type: 'hour',
                count: 3,
                text: '3h'
            },{
                type: 'hour',
                count: 8,
                text: '8h'
            },{
                type: 'day',
                count: 1,
                text: '1d'
            }, {
                type: 'day',
                count: 2,
                text: '2d'
            }, {
                type: 'week',
                count: 1,
                text: '1w'
            }, {
                type: 'month',
                count: 1,
                text: '1m'
            }]
        },
        navigator: {

            adaptToUpdatedData: false,
            series: {
                data: [
                    [1488555863000,0  ],
                    [1488867545000,0  ],
                    [1488988750000,0  ],
                    [1489326894000,0  ],
                    [1489595246000,0  ],
                    [1489918471000,1294  ],
                    [1490602360000,0  ],
                    [1490968926000,0  ],
                    [1491472500000,691  ],
                    [1491878739000,853  ],
                    [1491878743000,895  ],
                    [1492219349000,872  ],
                    [1492219351000,882  ],
                    [1492609571000,86139  ],
                    [1492609574000,86162  ],
                    [1492833247000,883  ],
                    [1492833249000,887  ],
                    [1492997396000,872  ],
                    [1492997398000,933  ],
                    [1493197253000,0  ],
                    [1493197255000,0  ],
                    [1493356150000,97378  ],
                    [1493365171000,706  ],
                    [1493392958000,0  ],
                    [1493553444000,755  ],
                    [1493553446000,755  ],
                    [1493715317000,696  ],
                    [1493812958000,0  ],
                    [1493915804000,97144  ],
                    [1493981696000,97290  ],
                    [1493993866000,0  ],
                    [1493993868000,0  ],
                    [1494160664000,0  ],
                    [1494160665000,0  ],
                    [1494326709000,0  ],
                    [1494326710000,0  ],
                    [1494503646000,31236  ],
                    [1494503648000,30946  ],
                    [1494716572000,873  ],
                    [1494716574000,898  ],
                    [1494913009000,906  ],
                    [1494930750000,0  ],
                    [1495106584000,0  ],
                    [1495188985000,0  ],
                    [1495396622000,26618  ],
                    [1495396624000,26871  ],
                    [1495568715000,42118  ],
                    [1495577844000,0  ],
                    [1495628781000,686  ],
                    [1495734792000,19993  ],
                    [1495796973000,0  ],
                    [1495796975000,0  ],
                    [1495903818000,760  ],
                    [1495956270000,42888  ],
                    [1495969499000,40653  ],
                    [1495969500000,40697  ],
                    [1496023319000,57867  ],
                    [1496140384000,59258  ],
                    [1496144096000,57563  ],
                    [1496144099000,57413  ],
                    [1496327530000,771  ],
                    [1496366716000,826  ],
                    [1496366718000,825  ],
                    [1496580356000,754  ],
                    [1496580358000,824  ],
                    [1496656870000,20211  ],
                    [1496789650000,774  ],
                    [1496789652000,809  ],
                    [1496942716000,35263  ],
                    [1496997406000,0  ],
                    [1496997408000,0  ],
                    [1497194424000,96817  ],
                    [1497201616000,764  ],
                    [1497361331000,0  ],
                    [1497513676000,65966  ],
                    [1497571590000,100276  ],
                    [1497614282000,744  ],
                    [1497693957000,47252  ],
                    [1497792180000,83575  ],
                    [1497825508000,1020  ],
                    [1497884880000,0  ],
                    [1497952283000,35362  ],
                    [1498016548000,42081  ],
                    [1498097887000,0  ],
                    [1498097889000,0  ],
                    [1498125381000,60251  ],
                    [1498241586000,72610  ],
                    [1498313132000,712  ],
                    [1498313134000,681  ],
                    [1498396248000,67873  ],
                    [1498453746000,79037  ],
                    [1498532827000,72805  ],
                    [1498564535000,0  ],
                    [1498618000000,54044  ],
                    [1498705012000,66100  ],
                    [1498784569000,1612  ],
                    [1498784571000,1601  ],
                    [1499023324000,727  ],
                    [1499179860000,0  ],
                    [1499408156000,816  ],
                    [1499766872000,17901  ],
                    [1499985819000,777  ],
                    [1499985821000,778  ],
                    [1500105204000,62735  ],
                    [1500201712000,0  ],
                    [1500201714000,0  ],
                    [1500362959000,0  ],
                    [1500417003000,57011  ],
                    [1500417006000,57077  ],
                    [1500558874000,69984  ],
                    [1500597122000,44980  ],
                    [1500635209000,0  ],
                    [1500635212000,0  ],
                    [1500698797000,44041  ],
                    [1500853422000,898  ],
                    [1500853424000,943  ],
                    [1501064231000,0  ],
                    [1501064234000,0  ],
                    [1501294144000,1042  ],
                    [1501503995000,748  ],
                    [1501563678000,57265  ],
                    [1501661817000,70121  ],
                    [1501722141000,1580  ],
                    [1501722143000,1656  ],
                    [1501819442000,51349  ],
                    [1501884901000,49012  ],
                    [1501942199000,71876  ],
                    [1501942201000,71742  ],
                    [1502008458000,0  ],
                    [1502076204000,77927  ],
                    [1502131295000,64018  ],
                    [1502171648000,40442  ],
                    [1502352390000,0  ],
                    [1502570788000,2134  ],
                    [1502570791000,2122  ],
                    [1502791978000,0  ],
                    [1502793913000,896  ],
                    [1502793915000,902  ],
                    [1502953762000,46192  ],
                    [1503023232000,16221  ],
                    [1503023235000,0  ],
                    [1503201055000,3183  ],
                    [1503264944000,33796  ],
                    [1503264946000,33862  ],
                    [1503459993000,31653  ],
                    [1503490569000,2495  ],
                    [1503490571000,2531  ],
                    [1503715756000,3168  ],
                    [1503715758000,3344  ],
                    [1503903439000,26226  ],
                    [1503945175000,0  ],
                    [1504165144000,4172  ],
                    [1504335938000,38005  ],
                    [1504395604000,856  ],
                    [1504395606000,888  ],
                    [1504578971000,43188  ],
                    [1504630937000,0  ],
                    [1504696798000,0  ],
                    [1504853108000,58025  ],
                    [1504936285000,828  ],
                    [1504936288000,831  ],
                    [1505101206000,31635  ],
                    [1505170007000,690  ],
                    [1505170010000,693  ],
                    [1505398316000,0  ],
                    [1505398318000,0  ],
                    [1505615230000,2171  ],
                    [1505615232000,2095  ],
                    [1505864100000,1036  ],
                    [1505864102000,1039  ],
                    [1506086215000,0  ],
                    [1506086663000,0  ],
                    [1506234697000,40825  ],
                    [1506315285000,64197  ],
                    [1506418735000,781  ],
                    [1506507050000,69080  ],
                    [1506610732000,81355  ],
                    [1506663894000,79565  ],
                    [1506663896000,79597  ],
                    [1506761732000,69452  ],
                    [1506852527000,38859  ],
                    [1506908431000,81134  ],
                    [1506908433000,81146  ],
                    [1506974476000,49109  ],
                    [1507043153000,78113  ],
                    [1507130225000,61889  ],
                    [1507150602000,37082  ],
                    [1507150604000,36994  ],
                    [1507239797000,0  ],
                    [1507335041000,73658  ],
                    [1507391186000,2015  ],
                    [1507391188000,2067  ],
                    [1507496318000,72179  ],
                    [1507605546000,55075  ],
                    [1507636044000,0  ],
                    [1507636046000,0  ],
                    [1507732607000,56730  ],
                    [1507876497000,781  ],
                    [1507876499000,857  ],
                    [1507992017000,26186  ],
                    [1508080845000,72254  ],
                    [1508122472000,73440  ],
                    [1508122474000,73220  ],
                    [1508217997000,46896  ],

                    [1508237074000,73541  ],
                    [1508243240000,0  ],
                    [1508244678000,83499  ],
                    [1508244680000,83357  ],
                    [1508252390000,72717  ],
                    [1508261032000,36899  ],
                    [1508269035000,48212  ],
                    [1508269037000,47880  ],
                    [1508283549000,86501  ],
                    [1508287974000,73975  ],
                    [1508293322000,69521  ],
                    [1508293325000,69811  ],
                    [1508299789000,66266  ],
                    [1508306887000,82865  ],
                    [1508315254000,38176  ],
                    [1508317688000,0  ],
                    [1508317691000,0  ],
                    [1508329198000,80811  ],
                    [1508333627000,82289  ],
                    [1508339406000,75328  ],
                    [1508342266000,82145  ],
                    [1508342268000,82405  ],
                    [1508349971000,28751  ],
                    [1508366725000,2858  ],
                    [1508366727000,2860  ],
                    [1508374399000,85482  ],
                    [1508380128000,79999  ],
                    [1508385513000,74117  ],
                    [1508391196000,76592  ],
                    [1508391198000,76398  ],
                    [1508398617000,69176  ],
                    [1508407293000,32384  ],
                    [1508415461000,42349  ],
                    [1508419935000,0  ],
                    [1508443924000,2664  ],
                    [1508445547000,87166  ],
                    [1508445549000,85598  ],
                    [1508449664000,84637  ],
                    [1508456280000,56645  ],
                    [1508464227000,79186  ],
                    [1508471244000,71340  ],
                    [1508471247000,71231  ],
                    [1508480997000,52510  ],
                    [1508490775000,44837  ],
                    [1508496346000,0  ],
                    [1508496348000,0  ],
                    [1508504115000,82669  ],
                    [1508508985000,74462  ],
                    [1508514906000,51936  ],
                    [1508521865000,0  ],
                    [1508521868000,0  ],
                    [1508529808000,67589  ],
                    [1508539326000,50015  ],
                    [1508547496000,5313  ],
                    [1508547499000,5312  ],
                    [1508560109000,0  ],
                    [1508566909000,76763  ],
                    [1508572657000,73217  ],
                    [1508572910000,71336  ],
                    [1508572912000,71315  ],
                    [1508580300000,84336  ],
                    [1508587227000,77249  ],
                    [1508595122000,47377  ],
                    [1508598440000,32164  ],
                    [1508598442000,56049  ],
                    [1508610045000,43157  ],
                    [1508624055000,5532  ],
                    [1508624057000,5485  ],
                    [1508634281000,77715  ],
                    [1508639910000,88201  ],
                    [1508645543000,79520  ],
                    [1508649688000,82057  ],
                    [1508649691000,82674  ],
                    [1508657281000,73718  ],
                    [1508666496000,55320  ],
                    [1508675182000,766  ],
                    [1508675184000,783  ],
                    [1508696614000,83257  ],
                    [1508699560000,81859  ],
                    [1508700664000,78873  ],
                    [1508700667000,80439  ],
                    [1508707252000,52112  ],
                    [1508715095000,86817  ],
                    [1508722227000,78001  ],
                    [1508726322000,69803  ],
                    [1508726324000,70070  ],
                    [1508735475000,37172  ],
                    [1508751817000,5478  ],
                    [1508751820000,5429  ],
                    [1508760343000,77360  ],
                    [1508777158000,0  ],
                    [1508777161000,0  ],
                    [1508802682000,73818  ],
                    [1508802685000,76427  ],

                    [1508802897000,78856  ],
                    [1508803030000,71930  ],
                    [1508803033000,75076  ],
                    [1508803293000,73934  ],
                    [1508803543000,77933  ],
                    [1508803792000,71551  ],
                    [1508804026000,76883  ],
                    [1508804304000,70940  ],
                    [1508804592000,49360  ],
                    [1508804890000,74374  ],
                    [1508805202000,80458  ],
                    [1508805458000,78577  ],
                    [1508805612000,75933  ],
                    [1508805614000,74890  ],
                    [1508805935000,75008  ],
                    [1508806249000,70376  ],
                    [1508806607000,85576  ],
                    [1508807048000,80189  ],
                    [1508807442000,83087  ],
                    [1508807995000,81300  ],
                    [1508808208000,82588  ],
                    [1508808210000,82999  ],
                    [1508808630000,80398  ],
                    [1508809127000,81761  ],
                    [1508809509000,82943  ],
                    [1508810100000,82090  ],
                    [1508810524000,83289  ],
                    [1508810792000,82782  ],
                    [1508810795000,81828  ],
                    [1508811447000,80107  ],
                    [1508812140000,80487  ],
                    [1508812986000,79212  ],
                    [1508813364000,63506  ],
                    [1508813366000,65342  ],
                    [1508813639000,76866  ],
                    [1508813992000,78720  ],
                    [1508814322000,0  ],
                    [1508814624000,71141  ],
                    [1508814960000,0  ],
                    [1508815282000,70335  ],
                    [1508815532000,0  ],
                    [1508815799000,0  ],
                    [1508815937000,66740  ],
                    [1508815939000,77020  ],
                    [1508816975000,72779  ],
                    [1508817802000,86246  ],
                    [1508818523000,82292  ],
                    [1508818525000,81687  ],
                    [1508820264000,18834  ],
                    [1508821119000,85984  ],
                    [1508821122000,85741  ],
                    [1508822095000,82275  ],
                    [1508822679000,81203  ],
                    [1508823515000,78737  ],
                    [1508823689000,83868  ],
                    [1508823692000,83451  ],
                    [1508824312000,0  ],
                    [1508824960000,83424  ],
                    [1508825819000,81474  ],
                    [1508826245000,79392  ],
                    [1508826247000,78940  ],
                    [1508827177000,76198  ],
                    [1508828144000,73442  ],
                    [1508828802000,78689  ],
                    [1508828805000,79133  ],
                    [1508829788000,77083  ],
                    [1508830595000,74178  ],
                    [1508831175000,71584  ],
                    [1508831377000,72020  ],
                    [1508831380000,71579  ],
                    [1508832262000,70217  ],
                    [1508833276000,43822  ],
                    [1508833965000,66047  ],
                    [1508833967000,66147  ],
                    [1508834882000,64720  ],
                    [1508835975000,62218  ],
                    [1508836545000,0  ],
                    [1508836547000,0  ],
                    [1508837660000,59905  ],
                    [1508838797000,57047  ],
                    [1508839123000,57725  ],
                    [1508839126000,57908  ],
                    [1508840405000,59214  ],
                    [1508841370000,55740  ],
                    [1508841675000,57065  ],
                    [1508841678000,57077  ],
                    [1508842765000,55800  ],
                    [1508843949000,52899  ],
                    [1508844237000,53006  ],
                    [1508844240000,52910  ],
                    [1508845400000,51512  ],
                    [1508846170000,50794  ],
                    [1508846775000,50236  ],
                    [1508848816000,0  ],
                    [1508851448000,0  ],
                    [1508851451000,0  ],
                    [1508854012000,1044  ],
                    [1508854015000,1136  ],
                    [1508856559000,1179  ]


                ],
                marker: {
                    enabled: false
                }

            }

        },
        scrollbar: {
            liveRedraw: false
        }
    });


});

function afterSetExtremes(e) {

    console.log('<b>Set extremes:</b> e.min: ' + Highcharts.dateFormat(null, e.min) +
        ' | e.max: ' + Highcharts.dateFormat(null, e.max) + ' | e.trigger: ' + e.trigger);

    var chart = Highcharts.charts[0];

    chart.showLoading('Loading data from server...');

    loadFromStubServer(Math.round(e.min),Math.round(e.max),function(){
        // do something else
    chart.hideLoading()});

    // $.getJSON('https://www.highcharts.com/samples/data/from-sql.php?start=' + Math.round(e.min) +
    //     '&end=' + Math.round(e.max) + '&callback=?', function (data) {
    //
    //     chart.series[0].setData(data);
    //     chart.hideLoading();
    // });
}
